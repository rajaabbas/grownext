# Worker v0.1.1 Plan

## Goals
- Execute admin-triggered bulk jobs asynchronously with robust error handling.
- Publish progress updates consumable by the admin UI.
- Centralize impersonation session cleanup tasks.

## Scope
1. **Bulk job processor**
   - Add queue consumer for `super-admin.bulk-job` queue handling ACTIVATE/SUSPEND/EXPORT actions.
   - Report progress via Redis pub/sub channel (`super-admin.bulk-job.status`).
   - Persist failures back to identity service for UI display.
2. **Export handling**
   - Generate CSV exports for EXPORT jobs and upload to storage (S3/GCS or signed URL).
   - Notify identity service with download link + expiry.
3. **Impersonation cleanup**
   - Nightly task to invalidate expired impersonation tokens and log audit events.
4. **Telemetry & metrics**
   - Publish queue depth / processing metrics to Redis or Prometheus exporters.
   - Expose bulk job status feed suitable for Tasks/Portal dashboards.

## Dependencies
- Identity must enqueue jobs with required payload (`docs/plans/identity/v0.1.1.md`).
- Admin UI expects real-time status updates (`docs/plans/admin/v0.1.1.md`).

## Testing
- Add Vitest unit tests for queue processors with mocked Redis/identity client.
- Create integration test harness that enqueues sample job and asserts status updates.

## Release Notes
- Bump `apps/worker/package.json` to **0.1.1** after delivering the new processors.
- Document new Redis channels and storage requirements in `docs/operations/runbooks/worker.md`.
